<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>서울시 재건축/재개발 현황</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body { padding: 20px; }
    .card-grid { display: flex; flex-wrap: wrap; gap: 1rem; }
    .redevelopment-card { width: calc(33% - 1rem); border: 1px solid #ccc; border-radius: 0.5rem; padding: 1rem; }
    .redevelopment-card img { width: 100%; height: auto; object-fit: cover; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    .autocomplete-suggestions { border: 1px solid #ccc; background: #fff; position: absolute; z-index: 1000; max-height: 200px; overflow-y: auto; }
    .autocomplete-suggestion { padding: 4px 8px; cursor: pointer; }
    .autocomplete-suggestion:hover { background: #f0f0f0; }
    .image-preview { position: absolute; z-index: 9999; background: white; border: 1px solid #ccc; padding: 4px; display: none; }
    .image-preview img { max-width: 300px; height: auto; }
  </style>
</head>
<body>
  <div class="mb-3 d-flex align-items-center">
    <input type="text" id="searchInput" class="form-control me-2" placeholder="법정동명 입력" style="width: 300px;" autocomplete="off">
    <button class="btn btn-primary" onclick="toggleView()">보기 전환</button>
  </div>
  <div id="autocomplete" class="autocomplete-suggestions"></div>
  <div id="listContainer"></div>

  <div class="image-preview" id="imgPreview"></div>

  <script>
    let data = []; // JSON 데이터 바인딩용
    let isCardView = false;

    async function fetchData() {
      const response = await fetch('./data/seoul.json');
      const json = await response.json();
      data = json.DATA;
      renderList(data);
    }

    function renderList(items) {
      const container = document.getElementById('listContainer');
      container.innerHTML = '';

      if (isCardView) {
        const grid = document.createElement('div');
        grid.className = 'card-grid';
        items.forEach(item => {
          const card = document.createElement('div');
          card.className = 'redevelopment-card';
          card.innerHTML = `
            <h5>${item['사업명']}</h5>
            <p>${item['법정동']}</p>
            <a href="${makeImageLink(item['위치도'])}" class="imglink" data-img="${makeImageLink(item['위치도'])}">위치도</a>
          `;
          grid.appendChild(card);
        });
        container.appendChild(grid);
      } else {
        const table = document.createElement('table');
        table.innerHTML = `
          <thead>
            <tr><th>사업명</th><th>법정동</th><th>위치도</th></tr>
          </thead>
          <tbody>
            ${items.map(item => `
              <tr>
                <td>${item['사업명']}</td>
                <td>${item['법정동']}</td>
                <td><a href="${makeImageLink(item['위치도'])}" class="imglink" data-img="${makeImageLink(item['위치도'])}">보기</a></td>
              </tr>`).join('')}
          </tbody>
        `;
        container.appendChild(table);
      }
    }

    function makeImageLink(url) {
      if (!url) return '#';
      return url.replace('https://charlie5450.github.io/SeoulRedevelopment/', 'https://');
    }

    function toggleView() {
      isCardView = !isCardView;
      renderList(data);
    }

    document.getElementById('searchInput').addEventListener('input', function () {
      const keyword = this.value.trim();
      const suggestBox = document.getElementById('autocomplete');
      suggestBox.innerHTML = '';

      if (keyword.length > 0) {
        const suggestions = [...new Set(data.map(d => d['법정동']).filter(name => name.includes(keyword)))];
        suggestions.forEach(s => {
          const div = document.createElement('div');
          div.className = 'autocomplete-suggestion';
          div.innerText = s;
          div.addEventListener('click', function () {
            document.getElementById('searchInput').value = s;
            suggestBox.innerHTML = '';
            const filtered = data.filter(item => item['법정동'].includes(s));
            renderList(filtered);
          });
          suggestBox.appendChild(div);
        });
        const rect = this.getBoundingClientRect();
        suggestBox.style.top = `${rect.bottom + window.scrollY}px`;
        suggestBox.style.left = `${rect.left + window.scrollX}px`;
        suggestBox.style.width = `${rect.width}px`;
      }
    });

    document.addEventListener('mouseover', function (e) {
      if (e.target.classList.contains('imglink')) {
        const imgUrl = e.target.getAttribute('data-img');
        const preview = document.getElementById('imgPreview');
        preview.innerHTML = `<img src="${imgUrl}" alt="미리보기">`;
        preview.style.display = 'block';
        preview.style.top = `${e.pageY + 10}px`;
        preview.style.left = `${e.pageX + 10}px`;
      }
    });

    document.addEventListener('mousemove', function (e) {
      const preview = document.getElementById('imgPreview');
      if (preview.style.display === 'block') {
        preview.style.top = `${e.pageY + 10}px`;
        preview.style.left = `${e.pageX + 10}px`;
      }
    });

    document.addEventListener('mouseout', function (e) {
      if (e.target.classList.contains('imglink')) {
        document.getElementById('imgPreview').style.display = 'none';
      }
    });

    fetchData();
  </script>
</body>
</html>
